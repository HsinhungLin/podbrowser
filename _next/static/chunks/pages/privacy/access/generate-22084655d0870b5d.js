(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[318],{74145:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return C}});var r=t(67294),o=t(27812),s=t(50029),c=t(87794),a=t.n(c),i=t(40478),u=t(88219),f=t(34121);async function l(e,n={}){const t=(0,u.aG)(Object.assign(Object.assign({},e),{status:f.vT}));return(0,u.RL)(e.requestor,t,n)}var d=l,p=t(18174),b=t(47874),h=t(9749),g=t(95287),w=t(35863);async function v(e,n){if(void 0===e)return;const t=await(0,h.Wg)(e,{fetch:n.fetch});if(0===(0,g.oY)(t,{acceptBlankNodes:!0}).length)return;const r=(0,w.nn)((0,g.oY)(t,{acceptBlankNodes:!0})[0],f.aR);return null!==r&&void 0!==r?r:void 0}async function y(e,n={}){const t=await(0,b._)(n),{accessEndpoint:r,storage:o}=await async function(e,n){const t={};let r;try{r=await(0,h.OE)(e,{fetch:n.fetch})}catch(a){throw new Error(`Cannot get the Access Management UI for ${e}: ${a}.`)}const o=(0,g.YY)(r,e);if(null===o)throw new Error(`Cannot get the Access Management UI for ${e}: the WebID cannot be dereferenced.`);const s=(0,w.nn)(o,f.aR);null!==s&&(t.accessEndpoint=s);const c=(0,w.nn)(o,f.CJ);return null!==c&&(t.storage=c),t}(e.toString(),{fetch:t});return null!==r&&void 0!==r?r:v(o,{fetch:t})}async function j(e,n,t={}){var r;const o=null!==(r=t.fallbackAccessManagementUi)&&void 0!==r?r:t.fallbackConsentManagementUi,s=await(0,p.b)(e,{fetch:t.fetch}),c=await async function(e){const n=await(0,b._)({fetch:e.fetch});let t;return t=e.resourceOwner?await y(e.resourceOwner,{fetch:n}):await v(e.resourceUrl,{fetch:n}),null!==t&&void 0!==t?t:e.fallbackUi}({resourceUrl:s.credentialSubject.hasConsent.forPersonalData[0],resourceOwner:t.resourceOwner,fallbackUi:o,fetch:t.fetch});if(void 0===c)throw new Error(`Cannot discover access management UI URL for [${s.credentialSubject.hasConsent.forPersonalData[0]}]${t.resourceOwner?`, neither from [${t.resourceOwner}]`:""}`);const a=new URL(c);if(a.searchParams.append("requestVc",btoa(JSON.stringify(s))),a.searchParams.append("redirectUrl",encodeURI("string"===typeof n?n:n.href)),void 0!==t&&void 0!==t.redirectCallback)t.redirectCallback(a.href);else{if("undefined"===typeof window)throw new Error("In a non-browser environment, a redirectCallback must be provided by the user.");window.location.href=a.href}}var m=t(23934),O=t(26605),S=t(21015);function x(){(0,m.KW)();var e=(0,i.useSession)().session,n={fetch:e.fetch},t=(0,r.useState)([]),c=t[0],u=t[1],f=(0,r.useState)([]),l=f[0],p=f[1],b=(0,r.useState)(null),h=b[0],g=b[1],w=(0,r.useState)([]),v=w[0],y=w[1],x=(0,O.Z)(e.info.webId).data;function C(){return(C=(0,s.Z)(a().mark((function t(r){var o,s;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r.preventDefault(),x){t.next=3;break}return t.abrupt("return");case 3:return t.next=5,d({requestor:e.info.webId,resourceOwner:l,access:{read:!0},resources:c,purpose:"https://example.org/someSpecificPurpose",requestorInboxUrl:null!==(o=x.inbox)&&void 0!==o?o:e.info.webId,options:n});case 5:(s=t.sent)&&h&&j(s,"".concat(h,"/privacy/?signedVcUrl=").concat(encodeURIComponent(s.id)),{fallbackConsentManagementUi:"".concat(h,"/privacy/access/requests/")});case 7:case"end":return t.stop()}}),t)})))).apply(this,arguments)}(0,r.useEffect)((function(){g(window.location.origin)}),[]);return x?r.createElement(r.Fragment,null,r.createElement("form",{onSubmit:function(e){return C.apply(this,arguments)},style:{display:"flex",flexDirection:"column",maxWidth:"max-content"}},"Generate consent request",r.createElement("label",{htmlFor:"owner"},"Resource Owner WebID:",r.createElement("input",{name:"owner",type:"url",value:l,onChange:function(e){p(e.target.value)}})),r.createElement("label",{htmlFor:"resource"},"Add resources to request:",r.createElement("input",{name:"owner",type:"url",value:v,onChange:function(e){y(e.target.value)}}),r.createElement("button",{type:"button",onClick:function(){return u([].concat((0,o.Z)(c),[v]))}},"Add")),r.createElement("div",null,c.map((function(e){return r.createElement("span",null,e)}))),r.createElement("button",{type:"submit"},"Generate consent request"))):r.createElement(S.Z,null)}function C(){return r.createElement(x,null)}},23934:function(e,n,t){"use strict";t.d(n,{KW:function(){return p},U2:function(){return b}});var r=t(50029),o=t(87794),s=t.n(o),c=t(67294),a=t(11163),i=t(40478),u="LOGGED_IN",f="LOGGED_OUT";function l(e,n,t,r){return d.apply(this,arguments)}function d(){return(d=(0,r.Z)(s().mark((function e(n,t,r,o){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=2;break}return e.abrupt("return");case 2:if(!n||r!==u){e.next=5;break}return e.next=5,a.default.push(o);case 5:if(n||r!==f){e.next=8;break}return e.next=8,a.default.push(o);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/login",n=(0,i.useSession)(),t=n.session,r=n.sessionRequestInProgress;(0,c.useEffect)((function(){t.info.isLoggedIn||l(t.info.isLoggedIn,r,f,e)}))}function b(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/",n=(0,i.useSession)(),t=n.session,r=n.sessionRequestInProgress,o=(0,a.useRouter)();(0,c.useEffect)((function(){t.info.isLoggedIn&&!o.asPath.includes("login")||r||l(t.info.isLoggedIn,r,u,e)}),[t,o,e,r])}},30799:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/privacy/access/generate",function(){return t(74145)}])},9708:function(e,n,t){"use strict";function r(e){return void 0!==e.credentialSubject.hasConsent?void 0!==e.credentialSubject.hasConsent.forPurpose:void 0!==e.credentialSubject.providedConsent.forPurpose}t.d(n,{n:function(){return r}})},88219:function(e,n,t){"use strict";t.d(n,{Fc:function(){return w},aG:function(){return g},RL:function(){return v}});var r=t(90882),o=t(46004);async function s(e,n,t,s,c){const a=Object.assign({},c);void 0===a.fetch&&(a.fetch=r.Z);const i=Object.assign({},t);delete i["@context"];const u=t["@context"],f=Object.assign({},s);delete f["@context"];const l=void 0!==s?s["@context"]:[],d=Object.assign({},f);delete d.type;const p=f.type;let b=[];void 0!==p&&(b=Array.isArray(p)?p:[p]);const h={credential:Object.assign(Object.assign({"@context":(0,o.Fq)(o.Of,u,l),type:[...o.qz,...b]},d),{credentialSubject:Object.assign({id:n},i)})},g=await a.fetch(e,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify(h)});if(!g.ok)throw new Error(`The VC issuing endpoint [${e}] could not successfully issue a VC for provided subject [${n}]: ${g.status} ${g.statusText}`);const w=await g.json();if((0,o.ik)(w))return w;throw new Error(`The VC issuing endpoint [${e}] returned an unexpected object: ${JSON.stringify(w,null,"  ")}`)}var c=t(34121),a=t(47874),i=t(9708),u=t(92897),f=t(83008),l=t(65239);function d(e){return(0,l.M)(e)&&void 0!==e.purpose}function p(e,n){const t={mode:(0,f.f)(e.access),hasStatus:e.status,forPersonalData:e.resources};return"BaseGrantBody"===n?Object.assign(Object.assign({},t),{isProvidedTo:e.requestor}):t}function b(e,n){const t={"@context":c.rd,type:["BaseGrantBody"===n?c.XY:c.d9],credentialSubject:{id:e.requestor,inbox:e.requestorInboxUrl}};return"BaseGrantBody"===n?Object.assign(Object.assign({},t),{credentialSubject:Object.assign(Object.assign({},t.credentialSubject),{providedConsent:p(e,n)})}):Object.assign(Object.assign({},t),{credentialSubject:Object.assign(Object.assign({},t.credentialSubject),{hasConsent:p(e,n)})})}function h(e,n){const t=Object.assign({},n);return e.issuanceDate&&(t.issuanceDate=e.issuanceDate.toISOString()),e.expirationDate&&(t.expirationDate=e.expirationDate.toISOString()),t}function g(e){const n=b(e,"BaseRequestBody");return d(e)?function(e,n){const t=h(e,n);return t.credentialSubject.hasConsent.forPurpose=e.purpose,t}(e,n):n}function w(e){const n=b(e,"BaseGrantBody");return n.credentialSubject.id=e.resourceOwner,n.type=[c.XY],d(e)?function(e,n){const t=h(e,n);return t.credentialSubject.providedConsent.forPurpose=e.purpose,t}(e,n):n}async function v(e,n,t){const r=await(0,a._)(t),o=void 0!==n.credentialSubject.hasConsent?n.credentialSubject.hasConsent.forPersonalData[0]:n.credentialSubject.providedConsent.forPersonalData[0];return s(new URL("issue",await(0,u.Mr)(o,t)).href,e,Object.assign({"@context":n["@context"]},n.credentialSubject),{"@context":n["@context"],type:n.type,issuanceDate:(0,i.n)(n)?n.issuanceDate:void 0,expirationDate:(0,i.n)(n)?n.expirationDate:void 0},{fetch:r})}}},function(e){e.O(0,[954,888,774,179],(function(){return n=30799,e(e.s=n);var n}));var n=e.O();_N_E=n}]);
//# sourceMappingURL=generate-22084655d0870b5d.js.map