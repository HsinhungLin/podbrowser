(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[391],{95322:function(e,n,t){"use strict";t.d(n,{ZP:function(){return p}});var r=t(50029),u=t(87794),s=t.n(u),a=t(67294),o=t(63431),i=t(29773),c=t(40478),f=t(15259),l={contacts:{OWN_WEBID_ERROR_MESSAGE:"You cannot add yourself as a contact."},permissions:{OWN_WEBID_ERROR_MESSAGE:"You cannot overwrite your own permissions."}};function d(e,n){return e.filter((function(e){return e.webId===n})).length}function p(e){var n=e.type,t=e.buttonText,u=e.children,p=e.dirtyForm,v=e.onChange,h=e.onSubmit,m=e.permissions,g=e.agentId,b=(0,o.Me)(),E=(0,c.useSession)().session,x=(0,a.useState)(p),I=x[0],S=x[1],k=!g&&(p||I),w=(0,a.useState)(null),y=w[0],Z=w[1],_=(0,a.useState)(!1),R=_[0],O=_[1],P=function(e,n,t){var u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],a=arguments.length>4?arguments[4]:void 0,o=arguments.length>5?arguments[5]:void 0;return function(){var i=(0,r.Z)(s().mark((function r(i){return s().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(i.preventDefault(),!(0,f.No)(n,e)){r.next=4;break}return t(!0),r.abrupt("return");case 4:if(!d(u,e)){r.next=7;break}return a(e),r.abrupt("return");case 7:return r.next=9,o(e);case 9:case"end":return r.stop()}}),r)})));return function(e){return i.apply(this,arguments)}}()}(g,E,O,m,Z,h),N=function(e,n,t){return function(r){e(r.target.value),n(!1),t(null)}}(v,O,Z),D=function(e){return function(){return e(!0)}}(S);return a.createElement(i.l0,{onSubmit:P},a.createElement(i.__,null,"WebID"),k&&a.createElement(i.v0,{variant:"invalid"},"Please provide a valid WebID"),R&&a.createElement(i.v0,{variant:"invalid"},l[n].OWN_WEBID_ERROR_MESSAGE),y&&a.createElement(i.v0,{variant:"invalid"},"The WebID ".concat(y," is already in your permissions.")),a.createElement(i.Jc,{id:b,onChange:N,value:g,type:"url",pattern:"https:\\/\\/\\S+",title:"Must be a valid URL that starts with https:// and does not contain spaces",onBlur:D,required:k,variant:y||R?"invalid":null}),u,a.createElement(i.zx,{type:"submit","data-testid":"add-agent-button"},t))}p.defaultProps={buttonText:"Add",children:null,dirtyForm:!1,onChange:function(){},onSubmit:function(){},permissions:[],agentId:"",type:"permissions"}},30053:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return P}});var r=t(67294),u=t(16835),s=t(50029),a=t(87794),o=t.n(a),i=t(11719),c=t(10150),f=t(54303),l=t(29773),d=t(86010),p=t(40478),v=t(80480),h=t(21015),m=t(38603),g=t(98258),b=t(95322),E=t(84549),x=t(46903),I=t(23934),S=t(59499),k=function(e){var n;return(0,f.createStyles)(e,["container","table"],{"container-view--menu-open":(n={},(0,S.Z)(n,e.breakpoints.up("sm"),{paddingRight:"50%"}),(0,S.Z)(n,e.breakpoints.up("md"),{paddingRight:"33.33%"}),(0,S.Z)(n,e.breakpoints.up("lg"),{paddingRight:"25%"}),n),"container-menu":{display:"flex",justifyContent:"space-between",margin:e.spacing(1,0,0)}})},w=t(1124),y=t(15259),Z=t(51059),_=t(16448),R=(0,i.Z)((function(e){return(0,c.Z)(k(e))}));function O(){(0,I.KW)();var e=(0,r.useContext)(x.ZP),n=e.alertSuccess,t=e.alertError,a=(0,p.useSession)().session,i=(0,r.useContext)(E.ZP).menuOpen,c=(0,f.useBem)(R()),S=(0,d.Z)(c("container"),c("container-view",i?"menu-open":null)),k=(0,_.Z)(),O=(0,g.Z)(),P=(0,u.Z)(O,1)[0],N=(0,r.useState)(!1),D=N[0],L=N[1],C=(0,r.useState)(""),W=C[0],T=C[1],M=(0,r.useState)(!1),A=M[0],B=M[1],F=(0,Z.Z)(P,v.ay.Person),G=F.data,U=F.error,Y=F.mutate;if(U&&t(U),D)return r.createElement(h.Z,null);var K=function(e){var n=e.addressBook,t=e.addressBookContainerUrl,r=e.setAgentId,u=e.setIsLoading,a=e.alertError,i=e.alertSuccess,c=e.session,f=e.setDirtyForm,l=e.peopleMutate,d=e.people;return function(){var e=(0,s.Z)(o().mark((function e(s){var p,v,h,g,b,E,x,I,S;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(p=c.fetch,f(!0),s){e.next=4;break}return e.abrupt("return");case 4:return(0,y.No)(c,s)&&a("You cannot add yourself as a contact"),u(!0),e.prev=6,e.next=9,(0,w.In)(s,p);case 9:return v=e.sent,h=v.name,g=v.webId,b=v.types,e.next=15,(0,m.NN)(d,g,p);case 15:if(!e.sent){e.next=20;break}return a("That WebID is already in your contacts"),u(!1),e.abrupt("return");case 20:return E={webId:g,fn:h||null},e.next=23,(0,m.xf)(n,t,E,b,p);case 23:x=e.sent,I=x.response,(S=x.error)&&a(S),I&&(i("".concat(E.fn||g," was added to your contacts")),r(""),l()),f(!1),e.next=34;break;case 31:e.prev=31,e.t0=e.catch(6),a("Unable to retrieve a profile from the given WebID");case 34:u(!1),f(!1);case 36:case"end":return e.stop()}}),e,null,[[6,31]])})));return function(n){return e.apply(this,arguments)}}()}({addressBook:P,addressBookContainerUrl:k,setAgentId:T,setIsLoading:L,alertError:t,alertSuccess:n,session:a,setDirtyForm:B,peopleMutate:Y,people:G}),j=r.createElement(l.iL,{href:"/contacts"},"contacts");return r.createElement("div",{className:S},r.createElement(l.dK,{link:j}),r.createElement("h3",null,"Add new contact"),r.createElement(b.ZP,{type:"contacts",onChange:function(e){return T(e)},onSubmit:K,buttonText:"Add Contact",agentId:W,dirtyForm:A}))}function P(){return r.createElement(O,null)}},84549:function(e,n,t){"use strict";t.d(n,{kj:function(){return u},g9:function(){return o}});var r=t(67294),u={DETAILS:"details"},s={menuOpen:!1,setMenuOpen:function(e){return e}},a=(0,r.createContext)(s);function o(e){var n=e.children,t=(0,r.useState)(!1),u=t[0],s=t[1];return r.createElement(a.Provider,{value:{menuOpen:u,setMenuOpen:s}},n)}o.defaultProps={children:null},n.ZP=a},23934:function(e,n,t){"use strict";t.d(n,{KW:function(){return p},U2:function(){return v}});var r=t(50029),u=t(87794),s=t.n(u),a=t(67294),o=t(11163),i=t(40478),c="LOGGED_IN",f="LOGGED_OUT";function l(e,n,t,r){return d.apply(this,arguments)}function d(){return(d=(0,r.Z)(s().mark((function e(n,t,r,u){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=2;break}return e.abrupt("return");case 2:if(!n||r!==c){e.next=5;break}return e.next=5,o.default.push(u);case 5:if(n||r!==f){e.next=8;break}return e.next=8,o.default.push(u);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/login",n=(0,i.useSession)(),t=n.session,r=n.sessionRequestInProgress;(0,a.useEffect)((function(){t.info.isLoggedIn||l(t.info.isLoggedIn,r,f,e)}))}function v(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/",n=(0,i.useSession)(),t=n.session,r=n.sessionRequestInProgress,u=(0,o.useRouter)();(0,a.useEffect)((function(){t.info.isLoggedIn&&!u.asPath.includes("login")||r||l(t.info.isLoggedIn,r,c,e)}),[t,u,e,r])}},98258:function(e,n,t){"use strict";t.d(n,{Z:function(){return p}});var r=t(50029),u=t(87794),s=t.n(u),a=t(67294),o=t(40478),i=t(44770),c=t(38603),f=t(28e3),l=t(55612),d=t(16448);function p(){var e=(0,a.useState)(null),n=e[0],t=e[1],u=(0,a.useState)(null),p=u[0],v=u[1],h=(0,o.useSession)().session,m=(0,i.Z)().data,g=(0,d.Z)();return(0,a.useEffect)((function(){if(h.info.isLoggedIn&&m&&g){var e=m.webId,n=h.fetch,u=(0,c.kd)(g);(0,r.Z)(s().mark((function r(){var a,o,i,d,p,h;return s().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,(0,f.RX)(u,n);case 2:if(a=r.sent,o=a.response,i=a.error,!o){r.next=8;break}return t(o.dataset),r.abrupt("return");case 8:if(!i||!(0,l.ky)(i,l.O1.NOT_FOUND)){r.next=19;break}return r.next=11,(0,c.cR)({iri:g,owner:e},n);case 11:if(d=r.sent,p=d.response,!(h=d.error)){r.next=17;break}return v(h),r.abrupt("return");case 17:return t(p.index),r.abrupt("return");case 19:v(i);case 20:case"end":return r.stop()}}),r)})))()}}),[h,m,g]),[n,p]}},16448:function(e,n,t){"use strict";t.d(n,{Z:function(){return o}});var r=t(67294),u=t(40478),s=t(44770),a=t(38603);function o(){var e=(0,r.useState)(null),n=e[0],t=e[1],o=(0,u.useSession)().session,i=(0,s.Z)().data;return(0,r.useEffect)((function(){if(o.info.isLoggedIn&&i){var e=i.pods;t((0,a.I6)(e[0]))}}),[i,o.info.isLoggedIn]),n}},51059:function(e,n,t){"use strict";t.d(n,{Z:function(){return c}});var r=t(50029),u=t(87794),s=t.n(u),a=t(35345),o=t(40478),i=t(38603);function c(e,n){var t=(0,o.useSession)().session.fetch;return(0,a.ZP)(e,(0,r.Z)(s().mark((function r(){var u,a,o,c,f,l,d;return s().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return u=i.zY[n].indexFilePredicate,a=i.zY[n].contactTypeIri,r.next=4,(0,i.ml)(e,u,t);case 4:return o=r.sent,c=o.response,r.next=8,(0,i.K2)(c,a,t);case 8:if(f=r.sent,l=f.response,!(d=f.error)){r.next=13;break}throw d;case 13:return r.abrupt("return",l);case 14:case"end":return r.stop()}}),r)}))),{refreshInterval:0})}},35822:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/contacts/add",function(){return t(30053)}])},63431:function(e,n,t){"use strict";var r,u=(r=t(67294))&&"object"===typeof r&&"default"in r?r.default:r,s="id",a=0;function o(e){return a++,"".concat(e||s).concat(a)}var i=function(e,n){for(var t=[],r=0;r<e;r++)t.push(o(n));return t};function c(e){var n=u.useRef();return u.useEffect((function(){n.current=e})),n.current}n.Me=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1?arguments[1]:void 0,t=u.useRef([]),r=c(e),s=c(n);return e===r&&s===n||(t.current=i(e,n)),t.current}}},function(e){e.O(0,[888,774,179],(function(){return n=35822,e(e.s=n);var n}));var n=e.O();_N_E=n}]);
//# sourceMappingURL=add-33ab723d909e26b0.js.map